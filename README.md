## Запуск проекта

```bash
npm install
npm run dev
```

## Подключение к MySQL

В проект уже встроены данные подключения по умолчанию:

- `DB_HOST=127.0.0.1`
- `DB_PORT=3306`
- `DB_NAME=git`
- `DB_USER=git`
- `DB_PASSWORD=iA5eY6fB8x`

Если на сервере параметры другие, их можно переопределить через `.env.local`.

Также можно (рекомендуется) задать секреты:

```env
SESSION_SECRET=change-me-very-long-random-string
PASSWORD_SALT=change-me-password-salt
CODE_SECRET=change-me-code-secret
```

Если сервер работает по HTTP (без HTTPS), добавьте:

```env
AUTH_COOKIE_SECURE=false
```

Иначе secure-cookie может не записаться в браузер и после входа будет возвращать на `/login`.

По умолчанию secure-cookie теперь включается только если `APP_URL`/`NEXT_PUBLIC_APP_URL` задан с `https://` или если явно указать `AUTH_COOKIE_SECURE=true`.

## Логи

- Файл логов создается автоматически: `logs/app.log`
- В него пишутся события входа и проверки сессии (полезно для диагностики редиректов на `/login`).

## Регистрация и подтверждение

- Реальная регистрация и вход работают через MySQL.
- Код подтверждения сохраняется в таблице `email_verification_codes`.
- Сейчас код подтверждения возвращается в API-ответе и показывается на форме подтверждения, чтобы вы могли сразу тестировать без почтового сервера.

### Нужен ли почтовый сервер?

- Для **тестирования прямо сейчас** — **не нужен**.
- Для **боевого использования** — да, нужен SMTP/почтовый провайдер, чтобы отправлять код на e-mail вместо показа кода в интерфейсе.

## Что реализовано

- Реальная регистрация пользователей.
- Подтверждение e-mail кодом.
- Реальный вход по e-mail/паролю.
- Сессия в `httpOnly` cookie.
- Защита `/admin` с редиректом на `/login`.
- Выход через `/api/logout`.
- Автосоздание таблиц `users` и `email_verification_codes` при первом обращении.
- API и таблицы для сущностей админки: `clients`, `suppliers`, `products`, `deals`, `deliveries`, `finances` (автосоздание).
- На страницах клиентов/поставщиков/товаров включено сохранение в MySQL (добавление, редактирование, удаление).
- В карточке клиента добавлен автопоиск:
  - по ИНН (ФНС) с автозаполнением ОГРН, названия и адреса;
  - по БИК (ЦБ) с автозаполнением названия банка и корр. счета.
- На странице товаров добавлены:
  - автоподсказки владельца (по клиентам из базы) и производителя (по поставщикам из базы);
  - автоформат ТНВЭД при вводе;
  - нормализация десятичных чисел (запятая, автодобавление `0,`);
  - импорт/экспорт Excel: «Загрузить файл», «Скачать шаблон», «Скачать все в Excel» (по текущему фильтру).
- В настройках добавлено управление пользователями и ролями:
  - `admin` — полные права;
  - `manager` — без назначения повышенных прав;
  - `user` — только профиль.
